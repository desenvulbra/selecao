var app=angular.module("ulbra",["ngAnimate","ngMessages","ui.router","toastr","ui.utils.masks","ngMd5"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(t,r,e){r.otherwise("/"),e.interceptors.push("AuthInterceptor"),t.state("home",{url:"",templateUrl:"/views/home.html",controller:"HomeCtrl",controllerAs:"$ctrl"}).state("cursos",{url:"/cursos",templateUrl:"/views/cursos.html",controller:"CursosCtrl",controllerAs:"$ctrl"}).state("cadastro",{url:"/cadastro",templateUrl:"/views/cadastro.html",controller:"CadastroCtrl",controllerAs:"$ctrl"})}]);app.controller("CadastroCtrl",["Auth","TokenManager","toastr","$state",function(t,r,e,o){var n=this;n.submitting=!1,n.errorMessage={},n.usuario={sexo:null},n.cadastrar=function(){n.submitting=!0,t.register(n.usuario).then(function(t){r.saveToken(t.data.token),e.success("Usuário autenticado com sucesso."),o.go("cursos")}).catch(function(t){n.submitting=!1,n.errorMessage={},angular.forEach(t.data,function(t,r){n.form[r].$setValidity("server",!1),n.errorMessage[r]=t})})}}]),app.controller("CursosCtrl",["Curso","toastr",function(t,r){var e=this;e.cursos=[],t.obterCursos().then(function(t){e.cursos=t.data}).catch(function(){r.error("Falha ao carregar os cursos.")})}]),app.controller("HomeCtrl",["Auth","TokenManager","toastr","$state",function(t,r,e,o){var n=this;n.submitting=!1,n.login=function(){n.submitting=!0,t.authenticate(n.email,n.senha).then(function(t){r.saveToken(t.data.token),e.success("Usuário autenticado com sucesso."),o.go("cursos")}).catch(function(t){n.submitting=!1;var r=t.data.message;e.error(r)})},n.googleSignIn=function(){}}]),app.directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(t,r,e,o){o.$validators.compareTo=function(r){return r==t.otherModelValue},t.$watch("otherModelValue",function(){o.$validate()})}}}),app.directive("serverError",[function(){return{restrict:"A",require:["ngModel","^form"],link:function(t,r,e,o){var n=o[0],a=o[1];t.$watch(function(){return n.$modelValue},function(){a[e.name].$setValidity("server",!0)})}}}]),app.directive("validPassword",function(){return{require:"ngModel",link:function(t,r,e,o){o.$validators.validPassword=function(t){if(!t||t.length<8)return!1;var r=/[A-Z]/;return!!r.test(t)&&(!!(r=/[0-9]/).test(t)&&(r=/[^\w\s]/).test(t))}}}}),app.factory("Auth",["$http","md5",function(t,r){return{authenticate:function(e,o){return o=r.createHash(o),t.post("/auth/login",{email:e,senha:o})},register:function(e){return!(!e||!e.senha)&&(e=angular.copy(e,{}),e.senha=r.createHash(e.senha),t.post("/auth/register",e))}}}]),app.factory("AuthInterceptor",["TokenManager",function(t){return{request:function(r){var e=t.getToken();return e&&(r.headers.Authorization=e),r}}}]),app.factory("Curso",["$http",function(t){return{obterCursos:function(){return t.get("/cursos")}}}]),app.factory("TokenManager",["$window",function(t){return{saveToken:function(r){t.localStorage.jwtToken=r},getToken:function(){return t.localStorage.jwtToken}}}]);